---

  - name: Fetch url for nodejs.
    shell: "curl --silent --location https://deb.nodesource.com/setup_0.12 | bash -"
    tags:
      - ember-install

  - name: Install nodejs.
    apt: name=nodejs force=yes
    tags:
      - ember-install

  - name: Install Ember globally.
    npm: name=ember-cli global=yes version=1.13.8
    tags:
      - ember-install

  - name: Install Ember Application dependencies
    shell: "npm install"
    args:
      chdir: "{{ install_dir }}/app"
    tags:
      - ember-install

  - name: Install Bower globally.
    npm: name=bower global=yes
    tags:
      - ember-install

  - name: Install Ember Application dependencies for bower
    shell: "bower install --allow-root"
    args:
      chdir: "{{ install_dir }}"
    tags:
      - ember-install

  - name: Install ember addons
    shell: ember install "{{ item }}"
    with_items: "{{ ember_addons }}"
    args:
      chdir: "{{ install_dir }}"
    tags:
      - ember-install

  - name: Fix ember-cli-bootstrap-tokenfield bug
    replace: dest={{ install_dir }}/node_modules/ember-cli-bootstrap-tokenfield/addon/components/input-tokenfield.js
             regexp='(.*)createTokenOnBlur(.*)'
             replace='\1createTokensOnBlur\2'

  - name: Create Ember config directory
    file: path={{install_dir}}/config state=directory
    tags:
      - ember-install
      - image-configure

  - name: Setup Ember configuration environment.
    template: src=environment.js.j2 dest={{ install_dir }}/config/environment.js
    tags:
      - ember-install
      - image-configure

  - name: Build ember for production.
    command: ember build --environment=production
    args:
      chdir: "{{ install_dir }}"
    tags:
      - ember-install
      - image-configure
