<!-- Content Header (Page header) -->


<!-- Main content -->
<section class="content">

  <section class="content-header">
      <h1>
          Dashboard
          <small>Lambda Application Details</small>
      </h1>
  </section>

  {{#if failed_delete}}
      <div  class="alert alert-dismissable alert-danger" id="alert">
        <button type="button" class="close" {{action "close_alert"}}>×</button>
        {{delete_error_message}}
      </div>
  {{/if}}
  {{#if success_delete}}
      <div  class="alert alert-dismissable alert-success" id="alert">
        <button type="button" class="close" {{action "close_alert"}}>×</button>
        {{delete_success_message}}
      </div>
  {{/if}}

    <!-- TOP DATA -->
    <div class="row">
        <div class="col-xs-12">
            <div class="box box-warning">
                <div class="box-header with-border">
                    <h3 class="box-title"><i class="fa fa-laptop"></i> Application {{model.application.name}}</h3>

                    <div class="box-tools pull-right">
                        <small>ID: {{model.application.id}}</small>
                    </div>
                </div>

                <!-- /.box-header -->
                <div class="box-body">
                    <div class="row ">
                        <div class="col-xs-12">

                          <div class="pad">
                          This page contains information regarding your Lambda Application:<strong> {{model.application.name}} </strong><br>
                          You can view its details, <i>deploy</i> it on a Lambda Instance or <i>delete</i> it.
                          <br>On tab below, you can browse the Lambda Instance(s)
                          onto which this application has been deployed and <i>start, stop or undeploy</i> it.
                          <br> The visible buttons represent the available
                          actions you may take depending on the <i>status</i> of the Application.
                          </div>
                          {{#if model.application.deleting}}
                            {{#tool-tip}}
                              <button class="btn btn-danger btn-primary pull-right disabled has-tooltip"
                                      data-tooltip-content="<center>The application is being deleted!</center>">
                                  <i class="fa fa-times"></i> Deleting <i class="fa fa-spinner fa-spin"></i></button>
                            {{/tool-tip}}
                          {{else}}
                            <button name="del-btn" id="del-btn" class="btn btn-danger btn-primary pull-right"
                              {{action "delete_app" model.application.id}}><i class="fa fa-times"></i> Delete</button>
                          {{/if}}


                          {{#if (compare model.application.status_code '==' '0')}}
                            {{#link-to 'deploy-app-1' model.application.id}}
                                <button class="btn btn-primary pull-right"
                                        style="margin-right: 15px;"><i class="fa fa-mail-reply"> </i>
                                    Deploy on a lambda instance
                                </button>
                            {{/link-to}}
                          {{else}}
                          {{#tool-tip}}
                              <button class="btn btn-primary pull-right disabled has-tooltip"
                                      data-tooltip-content="<center>Cannot deploy an application, while its
                                      status is {{lower-case model.application.status_message}}!</center>"
                                      style="margin-right: 15px;"><i class="fa fa-mail-reply"> </i>
                                  Deploy on a lambda instance
                              </button>
                          {{/tool-tip}}
                          {{/if}}
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-9 col-sm-8">
                            <div class="pad">
                                Lambda Application Details
                            </div>
                        </div>
                        <!-- /.col -->

                    </div>
                    <!-- /.row -->

                    <div class="row">
                        <div class="col-ms-8 col-xs-6">
                            <table class="table table-bordered table-hover table-responsive">
                                <thead>
                                <tr>
                                    <th>Property</th>
                                    <th>Value</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr>
                                    <th>Pithos+ path</th>
                                    <td>{{model.application.path}}/{{model.application.name}}</td>
                                </tr>
                                <tr>
                                    <th>Application Type</th>
                                    <td>{{lower-case model.application.app_type}}</td>
                                </tr>
                                {{#if model.application.description}}
                                    <tr>
                                        <th>Description</th>
                                        <td>{{model.application.description}}</td>
                                    </tr>
                                {{/if}}
                                <tr>
                                    <th>Execution environment name</th>
                                    <td>{{model.application.execution_environment_name}}</td>
                                </tr>
                                <tr>
                                    <th>Status</th>
                                    <td>{{lower-case model.application.status_message}}</td>
                                </tr>
                                <tr>
                                    <th>Status code</th>
                                    <td>{{model.application.status_code}}</td>
                                </tr>
                                <tr>
                                    <th>Status detail</th>
                                    <td>{{model.application.status_detail}}</td>
                                </tr>
                                {{#if model.application.status_failure_message}}
                                    <tr>
                                        <th>Application failure message</th>
                                        <td>{{model.application.status_failure_message}}</td>
                                    </tr>
                                {{/if}}

                                </tbody>
                            </table>
                        </div>
                        <!--col-xs-12-->
                        <!-- About The Application -->
                        <div class="col-md-4 pull-right">
                            <div class="box box-primary">
                                <div class="box-header with-border">
                                    <h3 class="box-title"><i class="fa  fa-bullhorn"></i> About The Application</h3>
                                    <span style='margin-left:10px;'>
                                      {{#if (compare model.application.status_message "===" "UPLOADING")}}
                                          <i class="fa fa-circle text-danger "></i>
                                      {{/if}}
                                      {{#if (compare model.application.status_message "===" "FAILED")}}
                                          <i class="fa fa-circle text-warning "></i>
                                      {{/if}}
                                      {{#if (compare model.application.status_message "===" "UPLOADED")}}
                                          <i class="fa fa-circle text-success "></i>
                                      {{/if}}
                                      {{model.application.status_message}}
                                    </span>
                                </div>
                                <!-- /.box-header -->
                                <div class="box-body">
                                    <strong><i class="fa fa-pencil margin-r-5"></i> Status</strong>
                                    <p>
                                    <ul class="timeline">
                                        <!-- timeline time label -->
                                        <li class="time-label">
                                          {{#if (compare model.application.status_message "===" "UPLOADING")}}
                                              <span class="bg-orange">Status: {{model.application.status_message}}</span>
                                              <div class="spinner-loader" style="position: relative;top:0;bottom: 0;left: 15%;right: 0;margin: auto;"></div>
                                          {{/if}}
                                          {{#if (compare model.application.status_message "===" "FAILED")}}
                                              <span class="bg-red">Status: {{model.application.status_message}}</span>
                                          {{/if}}
                                          {{#if (compare model.application.status_message "===" "UPLOADED")}}
                                              <span class="bg-green">Status: {{model.application.status_message}}</span>
                                          {{/if}}
                                        </li>
                                        <li>
                                            <i class="fa fa-clock-o bg-gray"></i>
                                            <div class="timeline-item">
                                                <span class="time"><i class="fa fa-clock-o"></i> Now </span>
                                                <h3 class="timeline-header"><strong>{{model.application.status_message}}</strong> </h3>
                                                <div class="timeline-body">{{model.application.status_detail}}</div> <!-- class="timeline-body"-->
                                            </div> <!-- class="timeline-item" -->
                                        </li>
                                    </ul>
                                    </p>
                                    <strong><i class="fa fa-file-text-o margin-r-5"></i> Notes</strong>
                                    {{#if (compare model.application.status_message "===" "UPLOADING")}}
                                        <p>Your lambda application is being uploaded. Please wait...</p>
                                    {{/if}}
                                    {{#if (compare model.application.status_message "===" "FAILED")}}
                                        <p>Your lambda application upload has failed. You can delete it an try uploading it again.</p>
                                    {{/if}}
                                    {{#if (compare model.application.status_message "===" "UPLOADED")}}
                                        <p>Your lambda application has been uploaded. You can deploy it on a lambda instance.</p>
                                    {{/if}}
                                </div> <!-- /.box-body -->
                            </div><!-- /.box -->
                        </div> <!--col-md-3 pull-right -->
                        <!-- About The Application -->
                    </div>
                    <!--row-->
                </div>
                <!--box-->
            </div>
            <!-- box-primary -->
        </div>
        <!--col -->
    </div>
    <!--row-->

  {{#if (logical-op 'or' model.instances deployWait)}}

  {{#if failure}}
      {{#each model.app.errors as |error|}}
            <div  class="alert alert-dismissable alert-danger" id="alert">
              <button type="button" class="close" {{action "close_alert"}}>×</button>
              {{error.message}}
            </div>
      {{/each}}
  {{/if}}

  {{#if request}}
          <div  class="alert alert-dismissable alert-success" id="alert">
            <button type="button" class="close" {{action "close_alert"}}>×</button>
            {{message}}
          </div>
  {{/if}}

      <div class="row">
          <div class="col-xs-12">
              <div class="box box-info">
                  <div class="box-header with-border">
                      <h3 class="box-title"><i class="fa fa-th"></i> Lambda instances the application has been deployed onto
                      </h3>
                  </div>
                  <!-- /.box-header -->

                  <div class="box-body">
                      <div class="row">
                          <div class="col-ms-12 col-xs-12">
                              List of Lambda Instances the Application has been deployed on
                          </div>
                      </div>
                      <div class="row">

                          <div class="col-ms-8 col-xs-8">
                               <table class="table table-bordered table-hover table-responsive">
                                    <thead>
                                    {{#if model.instances}}
                                      <tr>
                                          <th>Instance Name</th>
                                          <th>Instance Status</th>
                                          <th>App started</th>
                                          <th>Actions</th>
                                      </tr>
                                    {{/if}}
                                    {{#if deployWait}}
                                      <tr>
                                          <th><span style="font-size: .9em;" class="label bg-orange">
                                              The application is currently being deployed on an instance
                                              <i class="fa fa-spinner fa-spin"></i>
                                          </span></th>
                                      </tr>
                                    {{/if}}
                                    </thead>
                                    <tbody>

                                      {{#each sortedInstances as |li|}}
                                          <tr>
                                              <td>
                                                {{#link-to 'lambda-instance' li.id
                                                tooltipContent=(concat "<center>" li.id "</center>")}}
                                                  {{li.name}}
                                                {{/link-to}}
                                              </td>
                                              <td>{{li.status_detail}}</td>
                                              <td>{{li.started_app}}</td>
                                              <td>
                                                {{#if (compare li.status_code '==' '0')}}
                                                    {{#if li.started_app}}
                                                    <td style="padding-right: 5px;">
                                                    {{#tool-tip}}
                                                      {{app-action start=true disabled=true
                                                      tool-tip-message="it is started!"}}
                                                    {{/tool-tip}}
                                                    </td>
                                                    <td style="padding-right: 5px;">
                                                      {{#tool-tip}}
                                                        {{app-action stop=true app=model.app request=request application-id=model.application.id instance-id=li.id failure=failure message=message action="start_stop"}}
                                                      {{/tool-tip}}
                                                    </td>
                                                    <td style="padding-right: 5px;">
                                                    {{#tool-tip}}
                                                      {{app-action withdraw=true disabled=true
                                                      tool-tip-message="it is started!"}}
                                                    {{/tool-tip}}
                                                    </td>
                                                    {{else}}
                                                    <td style="padding-right: 5px;">
                                                    {{#tool-tip}}
                                                      {{app-action start=true app=model.app request=request application-id=model.application.id instance-id=li.id failure=failure message=message action="start_stop"}}
                                                    {{/tool-tip}}
                                                    </td>
                                                    <td style="padding-right: 5px;">
                                                      {{#tool-tip}}
                                                        {{app-action stop=true disabled=true
                                                        tool-tip-message="it is already stopped!"}}
                                                      {{/tool-tip}}
                                                    </td>
                                                    <td style="padding-right: 5px;">
                                                    {{#tool-tip}}
                                                      {{app-action withdraw=true app=model.app request=request application-id=model.application.id instance-id=li.id failure=failure message=message action="withdraw"}}
                                                    {{/tool-tip}}
                                                    </td>
                                                    {{/if}}
                                                {{else}}
                                                    <td style="padding-right: 5px;">
                                                    {{#tool-tip}}
                                                      {{app-action start=true disabled=true
                                                      tool-tip-message=(concat "the lambda instance's status
                                                      is " (lower-case li.status_message))}}
                                                    {{/tool-tip}}
                                                    </td>
                                                    <td style="padding-right: 5px;">
                                                      {{#tool-tip}}
                                                        {{app-action stop=true disabled=true
                                                        tool-tip-message=(concat "the lambda instance's status
                                                      is " (lower-case li.status_message))}}
                                                      {{/tool-tip}}
                                                    </td>
                                                    <td style="padding-right: 5px;">
                                                    {{#tool-tip}}
                                                      {{app-action withdraw=true disabled=true
                                                      tool-tip-message=(concat "the lambda instance's status
                                                      is " (lower-case li.status_message))}}
                                                    {{/tool-tip}}
                                                    </td>
                                                {{/if}}
                                              </td>
                                          </tr>
                                      {{/each}}
                                    </tbody>
                               </table>
                              <!--class="table-responsive"-->
                          </div>
                          <!-- /.col -->
                      </div>
                      <!-- /.row -->
                  </div>
              </div>
          </div>
      </div>
  {{/if}}

</section><!-- /.content -->
