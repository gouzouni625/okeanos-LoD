---
  - name: Install apache2, apache2-dev and libapache2-mod-wsgi packages.
    apt: name={{ item }} state=latest
    with_items:
      - apache2
      - apache2-dev
      - libapache2-mod-wsgi

  - name: Install apache ssl, rewrite and headers modules.
    apache2_module: name={{item}} state=present
    with_items:
      - ssl
      - rewrite
      - headers
    notify:
      - restart_apache2

  - name: Copy ssl certificate file.
    copy: src={{ ssl_certificate_file }} dest=/etc/ssl/certs/{{ ssl_certificate_file }} owner=root group=root mode=0644
    notify: restart_apache2

  - name: Copy ssl certificate key file.
    copy: src={{ ssl_certificate_key_file }} dest=/etc/ssl/private/{{ ssl_certificate_key_file }} owner=root group=root mode=0400
    notify: restart_apache2

  - name: Copy ssl certificate chain file.
    copy: src={{ ssl_certificate_chain_file }} dest=/etc/ssl/certs/{{ ssl_certificate_chain_file }} owner=root group=root mode=0644
    notify: restart_apache2

  - name: Copy Lambda sites-available configuration.
    template: src=central-service-backend.conf.j2 dest=/etc/apache2/sites-available/central-service-backend.conf

  - name: Copy lambda sites-available mkdocs configuration.
    template: src=central-service-mkdocs.conf.j2 dest=/etc/apache2/sites-available/central-service-mkdocs.conf

  - name: Add central-service-backend to sites-enabled.
    command: a2ensite central-service-backend.conf

  - name: Add central-service-mkdocs to sites-enabled.
    command: a2ensite central-service-mkdocs.conf

  - name: Disable default apache sites.
    command: a2dissite {{ item }}
    with_items:
      - 000-default.conf
      - default-ssl.conf
    notify:
      - restart_apache2

  - name: Configure Apache.
    lineinfile: dest=/etc/apache2/apache2.conf line="WSGIPythonPath {{ repository_download_path }}/okeanos-LoD/central_service/app" state=present insertafter=EOF
    notify:
      - restart_apache2
